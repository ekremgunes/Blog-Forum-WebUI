<!DOCTYPE html>
<html lang="en">

<head>
    <!-- basic page need -->
    <title>Create Content</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- meta tag -->
    <meta name="description" content="Blog Sinlge">
    <!-- custom css -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/theme.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="assets/css/single.css">
    <!-- libs -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css"
        integrity="sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.css"
        integrity="sha512-+ouAqATs1y4kpPMCHfKHVJwf308zo+tC9dlEYK9rKe7kiP35NiP+Oi35rCFnc16zdvk9aBkDUtEO3tIPl0xN5w=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dosis&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/write.css">
    <link rel="stylesheet" href="assets/libs/toastr/toastr.min.css">

    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />

    <link rel="stylesheet" href="assets/css/editor.css">
    <link rel="stylesheet" href="assets/css/hambugermenu.css">
</head>


<body class="light">
    <header class="mx-lg-4 mx-3">
        <div class="nav-area container-fluid  px-3 px-lg-5">

            <div id="nav-logo">
                <a href="/index.html">
                    <img src="assets/images/ekrem gunes-logos.jpeg" width="45rem" style="border-radius: 50%;"
                        alt="LOGO">
                    <!-- <h3>Forum</h3> -->
                </a>
            </div>

            <div id="nav-links">
                <ul>
                    <a href="/write.html">
                        <li><i class="fa-sharp fa-solid fa-feather"></i>Write</li>
                    </a>
                    <a href="#">
                        <li><i class="fa-regular fa-bell"></i>Notify</li>
                    </a>
                    <a href="#">
                        <li><i class="fa-regular fa-user"></i>User</li>
                    </a>

                    <li class="switch-parent">
                        <label class="switch">
                            <input id="switch-input" type="checkbox">
                            <span class="slider round"></span>
                        </label>
                    </li>
                </ul>
            </div>
            <div id="hamburgerDiv" class="open">
                <span class="cls"></span>
                <span>
                    <ul class="sub-menu ">
                        <li>
                            <a href="write.html" title="about">Write</a>
                        </li>
                        <li>
                            <a href="user.html" title="skills">User</a>
                        </li>
                        <li>
                            <a href="login.html" title="jobs">Login</a>
                        </li>
                        <li class="switch-parent">
                            <a href="javascript:void(0)" id="mobileDarkSwitch">Dark Mode</a>

                        </li>
                    </ul>
                </span>
                <span class="cls"></span>
            </div>
        </div>
    </header>
    <main id="main" class="row px-2 px-lg-3 mx-1 mx-md-3 mx-lg-4">


        <section id="middle-forum-section" class="col-lg-9 col-12 ">
            <div class="post-area ">
                <div class="post">
                    <div>
                        <div id="editor"></div>
                        <div>
                            <label class="form-label" for="">Title</label>
                            <input id="form-title" type="text" class="form-control">
                            <br>
                        </div>
                        <div>
                            <label class="form-label" for="">Category</label>
                            <select class="form-select" id="form-category">
                                <option value="Select Category" disabled selected>Select Category</option>
                                <!-- other options -->
                                <option value="1">Tech</option>
                                <option value="2">Sport</option>
                                <option value="3">Art</option>

                            </select>
                            <br>
                        </div>
                        <label class="form-label" for="">Tags</label>
                        <div class="keyHandler">
                            <button type="button" id="addKey">+</button>
                            <input class="form-control" type="text" placeholder="Keyword + Enter" id="keysInput">
                        </div>
                        <div id="form-tags" class="addedKeysHolder"></div>


                        <input type="hidden" id="lkey" name="tags">
                        <div class="col-12">
                            <button class="write-btn" type="button" onclick="SendContent(this)"
                                id="write-btn">Send</button>
                            <button class="write-btn" type="button" onclick="ResetEditor()">Reset</button>
                        </div>
                    </div>
                </div>


            </div>

        </section>
        <section id="right-forum-section" class="col-12 col-lg-3">

            <div class="user-info">
                <a href="/user.html"><img src="assets/images/user_woman.jpg" alt=""></a>
                <h4>Natalia</h4>
                <h6>Yazar / Japonya</h6>
                <h6>343 Takipçi</h6>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Delectus earum aliquam quidem facilis odio
                    illum ratione voluptatum ..</p>
                <button class="btn-follow" type="button">Follow</button>
            </div>

            <div id="footer">
                <div id="footer-social-links">
                    <ul>
                        <li><a href="#"><i class="fa-brands fa-instagram"></i>Instagram</a></li>
                        <li><a href="#"><i class="fa-brands fa-linkedin"></i>Linkedin</a></li>
                        <li><a href="#"><i class="fa-brands fa-github"></i>Github</a></li>
                        <li><a href="#"><i class="fa-brands fa-facebook"></i>Facebook</a></li>
                    </ul>
                </div>
                <div class="text-center">Copyright Forum 2023 &copy;</div>

            </div>
        </section>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.js"
        integrity="sha512-6DC1eE3AWg1bgitkoaRM1lhY98PxbMIbhgYCGV107aZlyzzvaWCW1nJW2vDuYQm06hXrW0As6OGKcIaAVWnHJw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="assets/libs/toastr/toastr.min.js"></script>
    <script src="assets/js/hamburgermenu.js"></script>
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <script>




        //call addKey() by pressing Enter (  This block is optional!  )
        $(window).keydown(function (event) {
            if (event.keyCode == 13) {
                event.preventDefault();
                addKey();
                return false;
            }
        });

        //call addKey() by pressing button
        $('#addKey').click(function (e) {
            addKey();
        });


        //Add key function
        function addKey() {
            let key = $('#keysInput').val()
            if (key != '') {
                let tag = document.createElement('span')
                $(tag).append(key)
                $(tag).attr('onclick', `$(this).remove();removeKey("${key}");`)
                $('.addedKeysHolder').append(tag)
                $('#keysInput').val('')
                resetKey()
            }
        }

        function removeKey() {
            resetKey()
        }

        //Reset all keys
        function resetKey() {
            $('#lkey').val('')
            for (let i = 1; i <= $('.addedKeysHolder span').length; i++) {
                let theKey = $(`.addedKeysHolder span:nth-child(${i})`).text()
                let prevVal = $('#lkey').val() + ','
                $('#lkey').val(prevVal + theKey)
            }
            $('#lkey').val($('#lkey').val());
            $('#keysInput').focus();
        }

        const { Editor } = toastui;
        const editor = new Editor({
            el: document.querySelector('#editor'),
            previewStyle: 'vertical',
            initialEditType: 'wysiwyg',
            height: '400px'
        });

        editor.focus()
        const ResetEditor = () => {
            editor.reset()
        }

        function checkEditor(html) {
            var hasImgTag = /<img\s[^>]*>/i.test(html);
            var hasImgSrc = /<img\s[^>]*src=["'][^"']*["'][^>]*>/i.test(html);
            var isImgSrcEmpty = /<img\s[^>]*src=["'][\s]*["'][^>]*>/i.test(html);

            if (hasImgTag && hasImgSrc && !isImgSrcEmpty) {
                return true
            } else {
                var prevLength;
                do {
                    prevLength = html.length;
                    html = html
                        .replace(/<\/?[A-Za-z]+\/?>/g, '') // boş etiketleri kaldır
                        .replace(/<\/?[\s\S]*?>/g, '') // diğer boş etiketleri kaldır
                        .replace(/^\s*\n/gm, '') // boş satırları kaldır
                        .replace(/&nbsp;|&#160;/gi, ' ') // özel karakterleri boşlukla değiştir
                        .replace(/<\/?(\w+)[^>]*>/g, function (match, p1) {
                            // table tag'larını düzenle
                            if (p1.toLowerCase() === 'table') {
                                return match.replace(/[\r\n]+/g, '').replace(/>\s+</g, '><');
                            }
                            return match;
                        });
                } while (html.length !== prevLength);

                if (html.replace(/\s/g, '').length > 10) {
                    return true
                } else {
                    return false
                }
            }

        }

        const SendContent = (e) => {
            var tags = [];
            $("#form-tags span").each(function () {
                tags.push($(this).text());
            });
            var category = $("#form-category").val()
            var title = $("#form-title").val()
            
            if (title.length < 10) {
                toastr.warning("Title is too short")
                $("#form-title").focus()
                return
            }
            if (category == "") {
                toastr.warning("Category is empty")
                $("#form-category").focus()
                return
            }
            var html = editor.getHTML()
            var editorController = checkEditor(html)
            if (editorController) {
                if (html.toString().length > 4000000) {
                    toastr.error("Too much content images and texts greater than ~4mb :(")
                    return
                }
                toastr.info("Post sending")
                var data = {
                    title: title,
                    content: html,
                    category: category,
                    tags: tags
                }
                console.log(JSON.stringify(data))
                // $.ajax({
                //     url: "YOUR URL",
                //     method: "POST",
                //     data: JSON.stringify(data),
                //     contentType: "application/json"
                // })
                //     .done(function (response) {
                //         console.log(response);
                //     })
                //     .fail(function (response) {
                //         console.log(response);
                //     })

            } else {
                toastr.warning("Post can't be empty")
            }

        }
    </script>
    <script src="assets/js/app.js"></script>
    <script src="assets/js/theme.js"></script>

</body>

</html>